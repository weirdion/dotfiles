#!/usr/bin/env zsh

# Reference blog - https://ostechnix.com/yt-dlp-tutorial/

RESOLUTION="1080"
set +x

function _ytGetVideo() {
    local filename=$(yt-dlp --get-filename -o "%(title)s.%(ext)s" "$2" | sed 's/ /./g')
    yt-dlp -S "res:$1" \
        --write-info-json \
        --write-sub \
        --write-thumbnail \
        -o "$filename" "$2"
}

if ! command -v yt-dlp &> /dev/null; then
    echo -e "\033[0;31mError: yt-dlp is not installed.\033[0m"
    echo -e "\033[0;37mInstall it with - breww install yt-dlp\033[0m"
    exit 1
fi

if [ "$#" -eq 1 ]; then
    _ytGetVideo "$RESOLUTION" "$1"
elif [ "$#" -eq 2 ]; then
    _ytGetVideo "$1" "$2"
else
    echo -e  "\033[0;31mUnable to execute the command.\033[0m"
    echo -e  "\033[0;37mUsage: ytGetVideo [resolution] <URL>\033[0m"
    exit 1
fi
